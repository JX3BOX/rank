(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0a79a197"],{"35ef":function(t,e,a){},"524f":function(t,e,a){"use strict";a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return i}));var n=a("41cb");function s(t){return Object(n["e"])().get("/api/team/team-gift-record/list/public",{params:t})}function i(){return Object(n["a"])().get("/api/cms/user/my/info",{params:{__no_cache:1}})}},"60d7":function(t){t.exports=JSON.parse('["蝶恋花","龙争虎斗","长安城","幽月轮","斗转星移","剑胆琴心","乾坤一掷","唯我独尊","梦江南","绝代天骄","天鹅坪","破阵子","飞龙在天","青梅煮酒","眉间雪","有人赴约","万象长安","山海相逢"]')},6477:function(t,e,a){"use strict";a("c304")},bcca:function(t,e,a){"use strict";var n=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{title:"绑定微信公众号",visible:t.visible,width:"30%","custom-class":"m-notice-wechat__dialog","before-close":t.handleClose,"append-to-body":""}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-wechat-content"},[t.ticket?e("el-image",{staticClass:"u-qr",attrs:{src:t.qrcodeValue,lazy:""}},[e("div",{staticClass:"u-error",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline"})])]):t._e(),e("i",{staticClass:"u-tip"},[t._v("打开微信扫一扫，关注剑三魔盒公众号")]),e("el-button",{staticClass:"u-btn",attrs:{type:"success",size:"small"},on:{click:t.confirm}},[t._v("我已绑定")])],1)])},s=[],i=(a("99af"),a("d3b7"),a("41cb"));function r(){return Object(i["a"])().get("/api/cms/wechat/mp/bind")}var o="https://mp.weixin.qq.com/cgi-bin/showqrcode",c={name:"BindWxMp",data:function(){return{ticket:"",loading:!1}},props:{visible:{type:Boolean,default:!1}},model:{prop:"visible",event:"update:visible"},computed:{qrcodeValue:function(){return"".concat(o,"?ticket=").concat(encodeURIComponent(this.ticket))}},watch:{visible:function(t){t&&this.loadQrcode()}},methods:{loadQrcode:function(){var t=this;this.loading=!0,r().then((function(e){var a;t.ticket=null===(a=e.data.data)||void 0===a?void 0:a.ticket})).finally((function(){t.loading=!1}))},handleClose:function(){this.$emit("update:visible",!1)},confirm:function(){this.$emit("update"),this.$emit("update:visible",!1)}}},u=c,l=(a("e42b"),a("2877")),d=Object(l["a"])(u,n,s,!1,null,null,null);e["a"]=d.exports},c304:function(t,e,a){},d7b2:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-rank-vote",attrs:{"element-loading-text":"加载中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.3)"}},[t.vote_note?e("div",{staticClass:"m-rank-vote-header",domProps:{innerHTML:t._s(t.vote_note)}}):t._e(),e("table",{staticClass:"m-rank-vote-table"},[e("thead",[e("tr",[e("th",{attrs:{width:"120px"}},[t._v("排名")]),e("th",{attrs:{width:"120px"}}),e("th",{attrs:{width:"120px"}},[t._v(" 团队 "),e("el-popover",{attrs:{placement:"top",width:"220",trigger:"click"}},[e("el-input",{attrs:{placeholder:"输入团队名关键字",clearable:""},model:{value:t.team_name,callback:function(e){t.team_name=e},expression:"team_name"}}),e("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e("i",{staticClass:"el-icon-search u-search-team"})])],1)],1),e("th",[e("el-select",{staticClass:"u-server u-select",attrs:{placeholder:"选择服务器",size:"mini"},model:{value:t.server,callback:function(e){t.server=e},expression:"server"}},[e("el-option",{key:"all",attrs:{label:"全部服务器",value:""}}),t._l(t.servers,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})}))],2)],1),1!=t.id?e("th",[t._v("团长&宣言")]):t._e(),e("th",[t._v("人气")]),e("th",[t._v("参与投票")])])]),1==t.id?e("vote-item-v1",{attrs:{team_name:t.team_name,server:t.server,data:t.data}}):e("vote-item-v2",{attrs:{team_name:t.team_name,server:t.server,data:t.data,"vote-team":t.voteTeam}})],1)])},s=[],i=(a("b64b"),a("d3b7"),a("65c2")),r=a("60d7"),o=(a("99af"),a("41cb"));function c(t){return 1==t?Object(o["e"])().get("/api/team/rank/events/".concat(t,"/all-teams"),{params:{return_all:1}}).then((function(t){return t.data.data.list||[]})):Object(o["e"])().get("/api/team/rank/events/".concat(t,"/all-teams/v2"),{params:{status:1}}).then((function(t){return t.data.data||[]}))}function u(t,e){return 1==t?Object(o["e"])().post("/api/team/events/".concat(t,"/vote-team/").concat(e)):Object(o["e"])({popType:"alert"}).post("/api/team/rank/vote","",{params:{event_id:~~t,team_id:~~e}})}function l(t){return Object(o["e"])({mute:!0}).get("/api/team/events/".concat(t,"/vote-team/status"))}a("b0c0");var d=function(){var t=this,e=t._self._c;return t.list&&t.list.length?e("tbody",t._l(t.list,(function(a,n){return e("tr",{directives:[{name:"show",rawName:"v-show",value:!t.hasCondition||t.isMatched(a),expression:"!hasCondition || isMatched(item)"}],key:n},[e("td",[e("i",{staticClass:"u-ranking"},[t._v(t._s(n+1))])]),e("td",[e("a",{attrs:{href:t.teamLink(a.team_id),target:"_blank"}},[e("img",{staticClass:"u-logo",attrs:{loading:"lazy",src:t.teamLogo(a.logo),alt:a.name}})])]),e("td",[e("a",{staticClass:"u-name",attrs:{href:t.teamLink(a.team_id),target:"_blank"}},[t._v(" "+t._s(a.name)+" ")])]),e("td",[e("span",{staticClass:"u-server"},[t._v(t._s(a.server))])]),e("td",[e("span",{staticClass:"u-count"},[t._v(t._s(a.guess))])]),e("td",{staticClass:"u-vote-wapper"},[e("button",{staticClass:"u-vote",class:{disabled:a.clicked||!t.event_status||t.hasVoted(a)||!t.canVote},attrs:{disabled:a.clicked||!t.event_status||t.hasVoted(a)||!t.canVote},on:{click:function(e){return t.vote(a)}}})])])})),0):t._e()},h=[],m=(a("caad"),a("2532"),a("e4f1")),v=a("85e4"),f=a("c9d2"),_={name:"voteItemV1",props:["data","team_name","server"],data:function(){return{isLogin:f["a"].isLogin()}},computed:{list:function(){return this.data},event_status:function(){return this.$store.state.race.status||!1},search_team:function(){return this.team_name},search_server:function(){return this.server},hasCondition:function(){return this.search_team||this.search_server},vote_end:function(){return this.$store.state.race.vote_end},canVote:function(){return Object(m["a"])().isBefore(Object(m["a"])(this.vote_end))}},methods:{isMatched:function(t){if(this.search_team&&this.search_server)return t.name.includes(this.search_team)&&t.server==this.search_server;var e=this.search_team&&t.name.includes(this.search_team),a=this.search_server&&t.server==this.search_server;return e||a},vote:function(t){var e=this;this.isLogin?u(this.id,t.team_id).then((function(a){e.$message({message:"感谢您的参与，投票成功！",type:"success",duration:1e3}),t.clicked=!0,t.guess=1+~~t.guess,e.$forceUpdate()})):f["a"].toLogin()},hasVoted:function(t){return this.voteTeam.includes(String(t.team_id))},teamLogo:function(t){return t?Object(v["h"])(t,96,!0):Object(v["h"])(i["default_avatar"],96,!0)},teamLink:function(t){return Object(v["e"])("org",t)}},mounted:function(){},components:{}},p=_,g=a("2877"),b=Object(g["a"])(p,d,h,!1,null,null,null),k=b.exports,C=function(){var t=this,e=t._self._c;return t.list&&t.list.length?e("tbody",[t._l(t.list,(function(a,n){return e("tr",{directives:[{name:"show",rawName:"v-show",value:!t.hasCondition||t.isMatched(a),expression:"!hasCondition || isMatched(item)"}],key:n},[e("td",[e("i",{staticClass:"u-ranking"},[t._v(t._s(n+1))])]),e("td",[e("a",{attrs:{href:t.teamLink(a.team_id),target:"_blank"}},[e("img",{staticClass:"u-logo",attrs:{loading:"lazy",src:t.teamLogo(a.logo),alt:a.name}})])]),e("td",[e("a",{staticClass:"u-name",attrs:{href:t.teamLink(a.team_id),target:"_blank"}},[t._v(t._s(a.name))])]),e("td",[e("span",{staticClass:"u-server"},[t._v(t._s(a.server))])]),e("td",[e("div",[e("a",{staticClass:"u-leader",attrs:{href:t.authorLink(a.uid)}},[t._v(t._s(a.leader))]),e("span",{staticClass:"u-slogan"},[t._v(t._s(a.slogan))])])]),e("td",[e("span",{staticClass:"u-count"},[t._v(t._s(a.count))])]),e("td",{staticClass:"u-vote-wapper"},[t.hasVoted(a)?e("div",[t._v("已投票")]):e("button",{staticClass:"u-vote",class:{disabled:a.clicked||!t.event_status||!t.canVote||t.voteTeam.length},on:{click:function(e){return t.vote(a)}}})])])})),e("bindWxMp",{on:{update:t.onBindWxMpUpdate},model:{value:t.showBindWxMp,callback:function(e){t.showBindWxMp=e},expression:"showBindWxMp"}})],2):t._e()},w=[],x=a("524f"),O=a("bcca"),j={name:"voteItemV2",props:["data","team_name","server","voteTeam"],components:{BindWxMp:O["a"]},data:function(){return{isLogin:f["a"].isLogin(),profile:null,showBindWxMp:!1}},computed:{id:function(){return~~this.$store.state.id},list:function(){return this.data},event_status:function(){return this.$store.state.race.status||!1},search_team:function(){return this.team_name},search_server:function(){return this.server},hasCondition:function(){return this.search_team||this.search_server},vote_end:function(){return this.$store.state.race.vote_end},canVote:function(){return Object(m["a"])().isBefore(Object(m["a"])(this.vote_end))},isWechatVerified:function(){var t;return!(null===(t=this.profile)||void 0===t||!t.wechat_mp_openid)}},mounted:function(){this.loadUser()},methods:{isMatched:function(t){if(this.search_team&&this.search_server)return t.name.includes(this.search_team)&&t.server==this.search_server;var e=this.search_team&&t.name.includes(this.search_team),a=this.search_server&&t.server==this.search_server;return e||a},vote:function(t){var e=this;this.isLogin?this.isWechatVerified?u(this.id,~~t.team_id).then((function(a){e.$message({message:"感谢您的参与，投票成功！",type:"success",duration:1e3}),t.clicked=!0,t.count=1+~~t.count,e.$forceUpdate()})):this.$alert("请先绑定微信公众号，再进行投票","消息",{confirmButtonText:"去绑定",callback:function(t){"confirm"==t&&(e.showBindWxMp=!0)}}):f["a"].toLogin()},hasVoted:function(t){return this.voteTeam.includes(String(t.team_id))},teamLogo:function(t){return t?Object(v["h"])(t,96,!0):Object(v["h"])(i["default_avatar"],96,!0)},teamLink:function(t){return Object(v["e"])("org",t)},authorLink:v["a"],loadUser:function(){var t=this;this.isLogin&&Object(x["b"])().then((function(e){t.profile=e.data.data}))},onBindWxMpUpdate:function(){this.loadUser()}}},L=j,y=Object(g["a"])(L,C,w,!1,null,null,null),M=y.exports,V={name:"Vote",props:[],data:function(){return{servers:r,vote_title_img:i["__imgPath"]+"image/rank/common/vote.png",loading:!1,data:[],team_name:"",server:"",voteTeam:[]}},computed:{id:function(){return~~this.$store.state.id},vote_note:function(){return this.$store.state.race.vote_note||""}},methods:{loadData:function(){var t=this;this.loading=!0,c(this.id).then((function(e){t.data=e})).finally((function(){t.loading=!1}))},getStatus:function(){var t=this;l(this.id).then((function(e){t.voteTeam=Object.keys(e.data.data||{})})).catch((function(t){console.log(t)}))},init:function(){this.loadData(),this.getStatus()}},watch:{id:{immediate:!0,handler:function(){this.init()}}},components:{"vote-item-v1":k,"vote-item-v2":M}},$=V,B=(a("6477"),Object(g["a"])($,n,s,!1,null,null,null));e["default"]=B.exports},e42b:function(t,e,a){"use strict";a("35ef")}}]);
//# sourceMappingURL=chunk-0a79a197.23de1ed7.js.map